<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeRunners - Plataforma</title>
    <link rel="stylesheet" href="css/styles.css">
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="img/logo-192.png">
    <link rel="apple-touch-icon" href="img/logo-192.png">

    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <meta name="theme-color" content="#00008B">
</head>
<body class="app-page">

    <div id="loader" class="loader-container">
        <div class="loader"></div>
        <p>Carregando Plataforma...</p>
    </div>

    <div id="app-container" class="hidden">
        
        <header class="app-header">
            <img src="img/logo-192.png" alt="LeRunners" style="height: 40px; width: auto;">
            
            <nav>
                <button id="nav-planilha-btn" class="btn btn-nav active">
                    <i class='bx bx-calendar'></i> <span>Planilha</span>
                </button>
                <button id="nav-feed-btn" class="btn btn-nav">
                    <i class='bx bx-news'></i> <span>Feed</span>
                </button>
                <button id="nav-finance-btn" class="btn btn-nav hidden">
                    <i class='bx bx-dollar-circle'></i> <span>Financeiro</span>
                </button>

                <button id="nav-profile-btn" class="btn btn-nav">
                    <i class='bx bx-user-circle'></i> <span>Meu Perfil</span>
                </button>

                <span id="userDisplay" class="user-display"></span>
                <button id="logoutButton" class="btn btn-danger">
                    <i class="bx bx-log-out"></i> Sair
                </button>
            </nav>
        </header>

        <main id="app-main-content" class="app-main">
            </main>
    </div>

    <footer class="app-footer">
        Desenvolvido com ü§ñ por thIAguinho Solu√ß√µes
    </footer>

    <template id="admin-panel-template">
        <div class="admin-dashboard">
            
            <div class="actions-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-bottom: 20px;">
                <div class="action-card" onclick="document.getElementById('athlete-search').focus()" style="background:white; padding:15px; text-align:center; border-radius:8px; border:1px solid #eee; cursor:pointer;">
                    <i class='bx bxs-group' style="font-size:2rem; color:#00008B;"></i><br><span style="font-size:0.8rem; font-weight:bold;">Alunos</span>
                </div>
                <div class="action-card" onclick="AppPrincipal.navigateTo('finance')" style="background:white; padding:15px; text-align:center; border-radius:8px; border:1px solid #eee; cursor:pointer;">
                    <i class='bx bxs-wallet' style="font-size:2rem; color:#28a745;"></i><br><span style="font-size:0.8rem; font-weight:bold;">Financeiro</span>
                </div>
                <div class="action-card" onclick="alert('Em desenvolvimento: Avalia√ß√µes')" style="background:white; padding:15px; text-align:center; border-radius:8px; border:1px solid #eee; cursor:pointer;">
                    <i class='bx bxs-bar-chart-alt-2' style="font-size:2rem; color:#ffc107;"></i><br><span style="font-size:0.8rem; font-weight:bold;">Avalia√ß√µes</span>
                </div>
                <div class="action-card" onclick="AppPrincipal.navigateTo('feed')" style="background:white; padding:15px; text-align:center; border-radius:8px; border:1px solid #eee; cursor:pointer;">
                    <i class='bx bxs-news' style="font-size:2rem; color:#fc4c02;"></i><br><span style="font-size:0.8rem; font-weight:bold;">Feed</span>
                </div>
            </div>

            <div class="panel approval-panel">
                <h3><i class='bx bx-user-check'></i> Aprova√ß√µes Pendentes</h3>
                <div id="pending-list">Carregando...</div>
            </div>

            <div class="admin-layout">
                <div class="athlete-list-container panel">
                    <h3><i class='bx bx-group'></i> Meus Atletas</h3>
                    <input type="text" id="athlete-search" class="search-input" placeholder="Pesquisar atleta...">
                    <div id="athlete-list" class="athlete-list">Carregando...</div>
                </div>

                <div class="athlete-details-container panel">
                    <h3 id="athlete-detail-name">Selecione um Atleta</h3>
                    
                    <div id="athlete-detail-content" class="hidden">
                        <div class="admin-action-buttons">
                            <button id="delete-athlete-btn" class="btn btn-danger btn-small">
                                <i class='bx bx-user-x'></i> Excluir Aluno
                            </button>
                        </div>
                        
                        <div class="admin-tabs">
                            <button class="tab-btn active" data-tab="prescrever">Prescrever</button>
                            <button class="tab-btn" data-tab="kpis">KPIs & IA</button>
                        </div>

                        <div id="admin-tab-prescrever" class="admin-tab-content active">
                            <h4><i class='bx bx-calendar-edit'></i> Prescrever Treino</h4>
                            
                            <form id="add-workout-form" class="form-minimal">
                                <div class="form-grid-2col">
                                    <div class="form-group"><label>Data</label><input type="date" id="workout-date" required></div>
                                    <div class="form-group"><label>T√≠tulo</label><input type="text" id="workout-title" required></div>
                                </div>
                                <fieldset class="workout-fieldset"><legend>Detalhes</legend>
                                    <div class="form-grid-2col">
                                        <div class="form-group"><label>Modalidade</label><select id="workout-modalidade"><option>Corrida</option><option>Caminhada</option><option>Bike</option><option>Nata√ß√£o</option></select></div>
                                        <div class="form-group"><label>Tipo</label><select id="workout-tipo-treino"><option>Rodagem</option><option>Longo</option><option>Intervalado</option><option>Fartlek</option><option>Regenerativo</option></select></div>
                                        <div class="form-group"><label>Intensidade</label><select id="workout-intensidade"><option>Leve (Z1/Z2)</option><option>Moderado (Z3)</option><option>Forte (Z4)</option><option>Muito Forte (Z5)</option></select></div>
                                        <div class="form-group"><label>Percurso</label><select id="workout-percurso"><option>Asfalto</option><option>Esteira</option><option>Pista</option><option>Trilha</option></select></div>
                                    </div>
                                </fieldset>
                                <div class="form-group"><label>Descri√ß√£o / Obs</label><textarea id="workout-observacoes" rows="3"></textarea></div>
                                <button type="submit" class="btn btn-secondary">Salvar Treino</button>
                            </form>
                            <hr>
                            <div id="workouts-list"></div>
                        </div>
                        <div id="admin-tab-kpis" class="admin-tab-content">
                            <h4><i class='bx bxs-brain'></i> IA Analysis</h4>
                            <button id="analyze-athlete-btn-ia" class="btn btn-secondary" style="width:100%">Gerar An√°lise</button>
                            <div id="ia-history-list" class="ia-history-list"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="atleta-panel-template">
        <div class="atleta-dashboard">
            <div class="atleta-header">
                <h2><i class="bx bx-run"></i> Minha Planilha</h2>
                <button id="log-manual-activity-btn" class="btn btn-primary"><i class='bx bx-plus-medical'></i> Log Manual</button>
            </div>
            <p class="subtitle">Ol√°, <span id="atleta-welcome-name">Atleta</span>!</p>
            <div id="atleta-workouts-container" class="panel">
                <div id="atleta-workouts-list">Carregando...</div>
            </div>
        </div>
    </template>

    <template id="feed-panel-template">
        <div class="feed-dashboard">
            <h2><i class='bx bx-news'></i> Feed</h2>
            <div id="feed-list" class="feed-list">Carregando...</div>
        </div>
    </template>

    <template id="finance-panel-template">
        <div class="finance-dashboard">
            <div class="flex-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2><i class='bx bx-dollar-circle'></i> Financeiro</h2>
                <div class="finance-tabs" style="display:flex; gap:10px;">
                    <button class="btn btn-small active" onclick="FinancePanel.switchTab('receber')">Receitas</button>
                    <button class="btn btn-small btn-secondary" onclick="FinancePanel.switchTab('pagar')">Despesas</button>
                    <button class="btn btn-small btn-nav" onclick="FinancePanel.switchTab('estoque')">Estoque</button>
                </div>
            </div>
            <div class="panel" style="background:#f8f9fa; border-left:5px solid var(--primary-color); margin-bottom:20px;">
                <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:15px; text-align:center;">
                    <div><small>Recebido</small><h3 style="color:var(--success-color);" id="fin-total-recebido">R$ 0,00</h3></div>
                    <div><small>Pago</small><h3 style="color:var(--danger-color);" id="fin-total-pago">R$ 0,00</h3></div>
                    <div><small>Saldo</small><h3 style="color:var(--primary-color);" id="fin-saldo">R$ 0,00</h3></div>
                </div>
            </div>
            <div id="fin-content-area"></div>
        </div>
    </template>

    <div id="feedback-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header"><h3 id="feedback-modal-title">Detalhes</h3><button class="close-btn">&times;</button></div>
            <div class="modal-body">
                <form id="feedback-form">
                    <div class="form-group"><label>Status</label><select id="workout-status"><option value="planejado">Planejado</option><option value="realizado">Realizado</option><option value="nao_realizado">N√£o Realizado</option></select></div>
                    <div class="form-group"><label>Feedback</label><textarea id="workout-feedback-text" rows="3"></textarea></div>
                    <div class="form-group"><label>Foto</label><input type="file" id="photo-upload-input"><p id="photo-upload-feedback"></p></div>
                    <div id="modal-strava-data" class="hidden" style="background:#f9f9f9; padding:10px; margin-top:10px; border-radius:5px;">
                        <h4 style="color:#fc4c02"><i class='bx bxl-strava'></i> Dados Strava</h4>
                        <div id="modal-strava-content"></div>
                    </div>
                    <button type="submit" id="save-feedback-btn" class="btn btn-primary" style="margin-top:10px">Salvar</button>
                </form>
                <hr>
                <div id="comments-list"></div>
                <form id="comment-form" style="display:flex; gap:5px;"><input id="comment-input" required><button class="btn btn-small"><i class='bx bxs-send'></i></button></form>
            </div>
        </div>
    </div>

    <div id="finance-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header"><h3 id="finance-modal-title">Transa√ß√£o</h3><button class="close-btn" onclick="document.getElementById('finance-modal').classList.add('hidden')">&times;</button></div>
            <div class="modal-body">
                <form id="finance-form">
                    <input type="hidden" id="fin-type">
                    <div class="form-group"><label>Descri√ß√£o / Nome</label><input id="fin-desc" required></div>
                    <div class="form-grid-2col">
                        <div class="form-group"><label>Valor (R$)</label><input type="number" id="fin-value" step="0.01" required></div>
                        <div class="form-group" id="fin-date-group"><label>Vencimento</label><input type="date" id="fin-date"></div>
                    </div>
                    <div class="form-group" id="fin-athlete-group"><label>Aluno</label><select id="fin-athlete-select"></select></div>
                    <fieldset id="fin-stock-area" class="hidden">
                        <legend>Estoque</legend>
                        <div class="form-group"><label>Produto</label><select id="fin-product-select"></select></div>
                        <div class="form-group"><label>Qtd</label><input type="number" id="fin-qty" value="1"></div>
                    </fieldset>
                    <button type="submit" class="btn btn-primary" style="width:100%; margin-top:10px">Salvar</button>
                </form>
            </div>
        </div>
    </div>

    <div id="profile-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header"><h3>Perfil</h3><button class="close-btn">&times;</button></div>
            <div class="modal-body">
                <form id="profile-form">
                    <img src="" id="profile-pic-preview" style="width:100px; height:100px; border-radius:50%; display:block; margin:0 auto;">
                    <div class="form-group"><label>Foto</label><input type="file" id="profile-pic-upload"></div>
                    <div class="form-group"><label>Nome</label><input type="text" id="profile-name"></div>
                    <div class="form-group"><label>Bio</label><textarea id="profile-bio"></textarea></div>
                    <button type="submit" id="save-profile-btn" class="btn btn-primary">Salvar</button>
                </form>
                <hr><div id="strava-connection-area"></div>
            </div>
        </div>
    </div>
    
    <div id="log-activity-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header"><h3>Log Manual</h3><button class="close-btn">&times;</button></div>
            <div class="modal-body">
                <form id="log-activity-form">
                    <div class="form-group"><label>Data</label><input type="date" id="log-activity-date" required></div>
                    <div class="form-group"><label>T√≠tulo</label><input type="text" id="log-activity-title" required></div>
                    <div class="form-group"><label>Desc</label><textarea id="log-activity-feedback"></textarea></div>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </form>
            </div>
        </div>
    </div>

    <div id="ia-analysis-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header"><h3>IA Analysis</h3><button class="close-btn">&times;</button></div>
            <div class="modal-body"><pre id="ia-analysis-output"></pre></div>
            <div class="modal-footer"><button id="save-ia-analysis-btn" class="btn btn-success hidden">Salvar</button></div>
        </div>
    </div>
    
    <div id="view-profile-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header"><h3>Perfil</h3><button class="close-btn" id="close-view-profile-modal">&times;</button></div>
            <div class="modal-body" style="text-align: center;">
                <img id="view-profile-pic" src="" style="width: 100px; height: 100px; border-radius: 50%;">
                <h2 id="view-profile-name"></h2><p id="view-profile-bio"></p>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>

    <script src="js/config.js"></script>
    <script src="js/app.js"></script>
    <script src="js/panels.js"></script>
    
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js').catch(e => console.error(e));
            });
        }
    </script>
</body>
</html>